<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/pasager.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=person">
    <title>Donner mon avis</title>
</head>

<body>

    <header>
        <div>
            <div class="banniere-logo">
                <img src="images/logo_simple.png" class="logo_ecoride" alt="logo_ecoride">
            </div>

            <div class="myself">
                <div>
                    <div class="showFirstnameMenu appbar">
                        <div class="firstname-menu">
                            <span id="firstname-display"></span>
                            <button id="logout-btn">Se déconnecter</button>
                        </div>
                    </div>
                </div>
                <div class="dropdown">
                    <button class="dropbtn btn_menu">
                        <img src="icons/icon_menu.png" class="icon_menu" alt="icon_menu">
                    </button>
                    <div class="dropdown-content">
                        <a href="criteres.html">covoiturages</a>
                        <a href="contact.html">contact</a>
                        <a href="login.html">connexion</a>
                        <a href="login.html">déconnexion</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="headnav">
            <nav>
                <a href="index.html" class="ahome">Accueil</a>
                <a href="register.html" class="acreer_uncompte">Créer un compte</a>
                <a href="login.html" class="alogin">Connexion</a>
            </nav>
        </div>
    </header>

  <h1>Laisser un avis sur un conducteur</h1>
  <form id="avisForm">
    <input type="number" id="conducteurId" placeholder="ID Conducteur" required />
    <input type="number" id="note" min="0" max="5" placeholder="Note sur 5" required />
    <textarea id="avis" placeholder="Votre avis..." required></textarea>
    <button type="submit">Envoyer</button>
  </form>

  <script>
    document.getElementById("avisForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const token = localStorage.getItem("token");
      const id = document.getElementById("conducteurId").value;
      const res = await fetch(`http://localhost:8080/api/v1/actor/${id}/avis`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          note: parseInt(document.getElementById("note").value),
          avis: document.getElementById("avis").value
        })
      });
      alert(res.ok ? "Avis envoyé pour validation" : "Erreur lors de l'envoi");
    });
  </script>
</body>
</html>
